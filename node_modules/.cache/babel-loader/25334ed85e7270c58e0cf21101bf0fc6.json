{"ast":null,"code":"import axios from 'axios';\nimport { createAsyncThunk } from '@reduxjs/toolkit';\nimport { toast } from 'react-toastify';\nimport { boardsApi } from 'store/boardsSlice';\nimport 'react-toastify/dist/ReactToastify.css';\nimport { PURGE } from 'redux-persist';\naxios.defaults.baseURL = 'https://taskpro-backend-uiwy.onrender.com';\nconst setToken = token => {\n  axios.defaults.headers.common.Authorization = `Bearer ${token}`;\n};\nconst clearToken = () => {\n  axios.defaults.headers.common.Authorization = '';\n};\nexport const register = createAsyncThunk('auth/register', async (credentials, thunkAPI) => {\n  try {\n    const {\n      data\n    } = await axios.post('/api/users/register', credentials);\n    setToken(data.user.token);\n    await thunkAPI.dispatch(boardsApi.util.invalidateTags(['Boards']));\n    return data;\n  } catch (error) {\n    return thunkAPI.rejectWithValue(error.message);\n  }\n});\nexport const logIn = createAsyncThunk('auth/login', async (credentials, thunkAPI) => {\n  try {\n    const {\n      data\n    } = await axios.post('/api/users/login', credentials);\n    setToken(data.token);\n    return data;\n  } catch (error) {\n    toast.error('Error: \"The email address or password is incorrect. Please retry...\"');\n    return thunkAPI.rejectWithValue(error.message);\n  }\n});\nexport const logOut = createAsyncThunk('auth/logout', async (_, thunkAPI) => {\n  try {\n    thunkAPI.dispatch({\n      type: 'auth/clearState'\n    });\n    clearToken();\n    localStorage.removeItem('token', 'activeBoardId');\n    await axios.post('/api/users/logout');\n    thunkAPI.dispatch({\n      type: PURGE,\n      key: 'root',\n      result: () => null\n    });\n  } catch (error) {\n    return thunkAPI.rejectWithValue(error.message);\n  }\n});\nexport const refreshUser = createAsyncThunk('auth/refresh', async (_, thunkAPI) => {\n  const state = thunkAPI.getState();\n  const persistedToken = state.auth.token;\n  if (!persistedToken) {\n    return thunkAPI.rejectWithValue('Oops');\n  }\n  setToken(persistedToken);\n  try {\n    const {\n      data\n    } = await axios.get('/api/users/current');\n    return data;\n  } catch (error) {\n    return thunkAPI.rejectWithValue(error.message);\n  }\n});\nexport const editProfile = createAsyncThunk('auth/editProfile', async (_ref, thunkAPI) => {\n  let {\n    formData,\n    token\n  } = _ref;\n  try {\n    const resp = await axios.patch('api/users', formData, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n    return resp.data.user;\n  } catch (error) {\n    return thunkAPI.rejectWithValue(error.message);\n  }\n});","map":{"version":3,"names":["axios","createAsyncThunk","toast","boardsApi","PURGE","defaults","baseURL","setToken","token","headers","common","Authorization","clearToken","register","credentials","thunkAPI","data","post","user","dispatch","util","invalidateTags","error","rejectWithValue","message","logIn","logOut","_","type","localStorage","removeItem","key","result","refreshUser","state","getState","persistedToken","auth","get","editProfile","_ref","formData","resp","patch"],"sources":["/Users/vlasvin/Documents/GitHub/TaskPro-FrontEnd-Team5/src/store/auth/authOperations.js"],"sourcesContent":["import axios from 'axios';\nimport { createAsyncThunk } from '@reduxjs/toolkit';\nimport { toast } from 'react-toastify';\nimport { boardsApi } from 'store/boardsSlice';\nimport 'react-toastify/dist/ReactToastify.css';\nimport { PURGE } from 'redux-persist';\n\naxios.defaults.baseURL = 'https://taskpro-backend-uiwy.onrender.com';\n\nconst setToken = token => {\n  axios.defaults.headers.common.Authorization = `Bearer ${token}`;\n};\n\nconst clearToken = () => {\n  axios.defaults.headers.common.Authorization = '';\n};\n\nexport const register = createAsyncThunk(\n  'auth/register',\n  async (credentials, thunkAPI) => {\n    try {\n      const { data } = await axios.post('/api/users/register', credentials);\n      setToken(data.user.token);\n\n      await thunkAPI.dispatch(boardsApi.util.invalidateTags(['Boards']));\n\n      return data;\n    } catch (error) {\n      return thunkAPI.rejectWithValue(error.message);\n    }\n  }\n);\n\nexport const logIn = createAsyncThunk(\n  'auth/login',\n  async (credentials, thunkAPI) => {\n    try {\n      const { data } = await axios.post('/api/users/login', credentials);\n      setToken(data.token);\n      return data;\n    } catch (error) {\n      toast.error(\n        'Error: \"The email address or password is incorrect. Please retry...\"'\n      );\n      return thunkAPI.rejectWithValue(error.message);\n    }\n  }\n);\n\nexport const logOut = createAsyncThunk('auth/logout', async (_, thunkAPI) => {\n  try {\n    thunkAPI.dispatch({ type: 'auth/clearState' });\n    clearToken();\n    localStorage.removeItem('token', 'activeBoardId');\n    await axios.post('/api/users/logout');\n    thunkAPI.dispatch({ type: PURGE, key: 'root', result: () => null });\n  } catch (error) {\n    return thunkAPI.rejectWithValue(error.message);\n  }\n});\n\nexport const refreshUser = createAsyncThunk(\n  'auth/refresh',\n  async (_, thunkAPI) => {\n    const state = thunkAPI.getState();\n    const persistedToken = state.auth.token;\n    if (!persistedToken) {\n      return thunkAPI.rejectWithValue('Oops');\n    }\n    setToken(persistedToken);\n    try {\n      const { data } = await axios.get('/api/users/current');\n      return data;\n    } catch (error) {\n      return thunkAPI.rejectWithValue(error.message);\n    }\n  }\n);\n\nexport const editProfile = createAsyncThunk(\n  'auth/editProfile',\n  async ({ formData, token }, thunkAPI) => {\n    try {\n      const resp = await axios.patch('api/users', formData, {\n        headers: {\n          Authorization: `Bearer ${token}`,\n          'Content-Type': 'multipart/form-data',\n        },\n      });\n\n      return resp.data.user;\n    } catch (error) {\n      return thunkAPI.rejectWithValue(error.message);\n    }\n  }\n);\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,gBAAgB,QAAQ,kBAAkB;AACnD,SAASC,KAAK,QAAQ,gBAAgB;AACtC,SAASC,SAAS,QAAQ,mBAAmB;AAC7C,OAAO,uCAAuC;AAC9C,SAASC,KAAK,QAAQ,eAAe;AAErCJ,KAAK,CAACK,QAAQ,CAACC,OAAO,GAAG,2CAA2C;AAEpE,MAAMC,QAAQ,GAAGC,KAAK,IAAI;EACxBR,KAAK,CAACK,QAAQ,CAACI,OAAO,CAACC,MAAM,CAACC,aAAa,GAAI,UAASH,KAAM,EAAC;AACjE,CAAC;AAED,MAAMI,UAAU,GAAGA,CAAA,KAAM;EACvBZ,KAAK,CAACK,QAAQ,CAACI,OAAO,CAACC,MAAM,CAACC,aAAa,GAAG,EAAE;AAClD,CAAC;AAED,OAAO,MAAME,QAAQ,GAAGZ,gBAAgB,CACtC,eAAe,EACf,OAAOa,WAAW,EAAEC,QAAQ,KAAK;EAC/B,IAAI;IACF,MAAM;MAAEC;IAAK,CAAC,GAAG,MAAMhB,KAAK,CAACiB,IAAI,CAAC,qBAAqB,EAAEH,WAAW,CAAC;IACrEP,QAAQ,CAACS,IAAI,CAACE,IAAI,CAACV,KAAK,CAAC;IAEzB,MAAMO,QAAQ,CAACI,QAAQ,CAAChB,SAAS,CAACiB,IAAI,CAACC,cAAc,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;IAElE,OAAOL,IAAI;EACb,CAAC,CAAC,OAAOM,KAAK,EAAE;IACd,OAAOP,QAAQ,CAACQ,eAAe,CAACD,KAAK,CAACE,OAAO,CAAC;EAChD;AACF,CACF,CAAC;AAED,OAAO,MAAMC,KAAK,GAAGxB,gBAAgB,CACnC,YAAY,EACZ,OAAOa,WAAW,EAAEC,QAAQ,KAAK;EAC/B,IAAI;IACF,MAAM;MAAEC;IAAK,CAAC,GAAG,MAAMhB,KAAK,CAACiB,IAAI,CAAC,kBAAkB,EAAEH,WAAW,CAAC;IAClEP,QAAQ,CAACS,IAAI,CAACR,KAAK,CAAC;IACpB,OAAOQ,IAAI;EACb,CAAC,CAAC,OAAOM,KAAK,EAAE;IACdpB,KAAK,CAACoB,KAAK,CACT,sEACF,CAAC;IACD,OAAOP,QAAQ,CAACQ,eAAe,CAACD,KAAK,CAACE,OAAO,CAAC;EAChD;AACF,CACF,CAAC;AAED,OAAO,MAAME,MAAM,GAAGzB,gBAAgB,CAAC,aAAa,EAAE,OAAO0B,CAAC,EAAEZ,QAAQ,KAAK;EAC3E,IAAI;IACFA,QAAQ,CAACI,QAAQ,CAAC;MAAES,IAAI,EAAE;IAAkB,CAAC,CAAC;IAC9ChB,UAAU,CAAC,CAAC;IACZiB,YAAY,CAACC,UAAU,CAAC,OAAO,EAAE,eAAe,CAAC;IACjD,MAAM9B,KAAK,CAACiB,IAAI,CAAC,mBAAmB,CAAC;IACrCF,QAAQ,CAACI,QAAQ,CAAC;MAAES,IAAI,EAAExB,KAAK;MAAE2B,GAAG,EAAE,MAAM;MAAEC,MAAM,EAAEA,CAAA,KAAM;IAAK,CAAC,CAAC;EACrE,CAAC,CAAC,OAAOV,KAAK,EAAE;IACd,OAAOP,QAAQ,CAACQ,eAAe,CAACD,KAAK,CAACE,OAAO,CAAC;EAChD;AACF,CAAC,CAAC;AAEF,OAAO,MAAMS,WAAW,GAAGhC,gBAAgB,CACzC,cAAc,EACd,OAAO0B,CAAC,EAAEZ,QAAQ,KAAK;EACrB,MAAMmB,KAAK,GAAGnB,QAAQ,CAACoB,QAAQ,CAAC,CAAC;EACjC,MAAMC,cAAc,GAAGF,KAAK,CAACG,IAAI,CAAC7B,KAAK;EACvC,IAAI,CAAC4B,cAAc,EAAE;IACnB,OAAOrB,QAAQ,CAACQ,eAAe,CAAC,MAAM,CAAC;EACzC;EACAhB,QAAQ,CAAC6B,cAAc,CAAC;EACxB,IAAI;IACF,MAAM;MAAEpB;IAAK,CAAC,GAAG,MAAMhB,KAAK,CAACsC,GAAG,CAAC,oBAAoB,CAAC;IACtD,OAAOtB,IAAI;EACb,CAAC,CAAC,OAAOM,KAAK,EAAE;IACd,OAAOP,QAAQ,CAACQ,eAAe,CAACD,KAAK,CAACE,OAAO,CAAC;EAChD;AACF,CACF,CAAC;AAED,OAAO,MAAMe,WAAW,GAAGtC,gBAAgB,CACzC,kBAAkB,EAClB,OAAAuC,IAAA,EAA4BzB,QAAQ,KAAK;EAAA,IAAlC;IAAE0B,QAAQ;IAAEjC;EAAM,CAAC,GAAAgC,IAAA;EACxB,IAAI;IACF,MAAME,IAAI,GAAG,MAAM1C,KAAK,CAAC2C,KAAK,CAAC,WAAW,EAAEF,QAAQ,EAAE;MACpDhC,OAAO,EAAE;QACPE,aAAa,EAAG,UAASH,KAAM,EAAC;QAChC,cAAc,EAAE;MAClB;IACF,CAAC,CAAC;IAEF,OAAOkC,IAAI,CAAC1B,IAAI,CAACE,IAAI;EACvB,CAAC,CAAC,OAAOI,KAAK,EAAE;IACd,OAAOP,QAAQ,CAACQ,eAAe,CAACD,KAAK,CAACE,OAAO,CAAC;EAChD;AACF,CACF,CAAC"},"metadata":{},"sourceType":"module"}