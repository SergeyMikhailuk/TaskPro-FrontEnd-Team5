{"ast":null,"code":"import axios from 'axios';\nimport { createAsyncThunk } from '@reduxjs/toolkit';\nimport { toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\naxios.defaults.baseURL = 'https://taskpro-backend-uiwy.onrender.com';\nconst setToken = token => {\n  axios.defaults.headers.common.Authorization = `Bearer ${token}`;\n};\nconst clearToken = () => {\n  axios.defaults.headers.common.Authorization = '';\n};\nexport const register = createAsyncThunk('auth/register', async (credentials, thunkAPI) => {\n  try {\n    const {\n      data\n    } = await axios.post('/api/users/register', credentials);\n    setToken(data.user.token);\n    return data;\n  } catch (error) {\n    return thunkAPI.rejectWithValue(error.message);\n  }\n});\nexport const logIn = createAsyncThunk('auth/login', async (credentials, thunkAPI) => {\n  try {\n    const {\n      data\n    } = await axios.post('/api/users/login', credentials);\n    setToken(data.token);\n    return data;\n  } catch (error) {\n    toast.error('Error: \"The email address or password is incorrect. Please retry...\"');\n    return thunkAPI.rejectWithValue(error.message);\n  }\n});\nexport const logOut = createAsyncThunk('auth/logout', async (_, thunkAPI) => {\n  try {\n    thunkAPI.dispatch({\n      type: 'auth/clearState'\n    });\n    clearToken();\n    localStorage.removeItem('token');\n    await axios.post('/api/users/logout');\n  } catch (error) {\n    return thunkAPI.rejectWithValue(error.message);\n  }\n});\nexport const refreshUser = createAsyncThunk('auth/refresh', async (_, thunkAPI) => {\n  const state = thunkAPI.getState();\n  const persistedToken = state.auth.token;\n  if (!persistedToken) {\n    return thunkAPI.rejectWithValue('Oops');\n  }\n  setToken(persistedToken);\n  try {\n    const {\n      data\n    } = await axios.get('/api/users/current');\n    return data;\n  } catch (error) {\n    return thunkAPI.rejectWithValue(error.message);\n  }\n});\nexport const editProfile = createAsyncThunk('auth/editProfile', async (_ref, thunkAPI) => {\n  let {\n    formData,\n    token\n  } = _ref;\n  try {\n    const resp = await axios.patch('api/users', formData, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n    return resp.data.user;\n  } catch (error) {\n    return thunkAPI.rejectWithValue(error.message);\n  }\n});","map":{"version":3,"names":["axios","createAsyncThunk","toast","defaults","baseURL","setToken","token","headers","common","Authorization","clearToken","register","credentials","thunkAPI","data","post","user","error","rejectWithValue","message","logIn","logOut","_","dispatch","type","localStorage","removeItem","refreshUser","state","getState","persistedToken","auth","get","editProfile","_ref","formData","resp","patch"],"sources":["/Users/vlasvin/Documents/GitHub/TaskPro-FrontEnd-Team5/src/store/auth/authOperations.js"],"sourcesContent":["import axios from 'axios';\nimport { createAsyncThunk } from '@reduxjs/toolkit';\nimport { toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\n\naxios.defaults.baseURL = 'https://taskpro-backend-uiwy.onrender.com';\n\nconst setToken = token => {\n  axios.defaults.headers.common.Authorization = `Bearer ${token}`;\n};\n\nconst clearToken = () => {\n  axios.defaults.headers.common.Authorization = '';\n};\n\nexport const register = createAsyncThunk(\n  'auth/register',\n  async (credentials, thunkAPI) => {\n    try {\n      const { data } = await axios.post('/api/users/register', credentials);\n      setToken(data.user.token);\n      return data;\n    } catch (error) {\n      return thunkAPI.rejectWithValue(error.message);\n    }\n  }\n);\n\nexport const logIn = createAsyncThunk(\n  'auth/login',\n  async (credentials, thunkAPI) => {\n    try {\n      const { data } = await axios.post('/api/users/login', credentials);\n      setToken(data.token);\n      return data;\n    } catch (error) {\n      toast.error(\n        'Error: \"The email address or password is incorrect. Please retry...\"'\n      );\n      return thunkAPI.rejectWithValue(error.message);\n    }\n  }\n);\n\nexport const logOut = createAsyncThunk('auth/logout', async (_, thunkAPI) => {\n  try {\n    thunkAPI.dispatch({ type: 'auth/clearState' });\n    clearToken();\n    localStorage.removeItem('token');\n    await axios.post('/api/users/logout');\n  } catch (error) {\n    return thunkAPI.rejectWithValue(error.message);\n  }\n});\n\nexport const refreshUser = createAsyncThunk(\n  'auth/refresh',\n  async (_, thunkAPI) => {\n    const state = thunkAPI.getState();\n    const persistedToken = state.auth.token;\n    if (!persistedToken) {\n      return thunkAPI.rejectWithValue('Oops');\n    }\n    setToken(persistedToken);\n    try {\n      const { data } = await axios.get('/api/users/current');\n      return data;\n    } catch (error) {\n      return thunkAPI.rejectWithValue(error.message);\n    }\n  }\n);\n\nexport const editProfile = createAsyncThunk(\n  'auth/editProfile',\n  async ({ formData, token }, thunkAPI) => {\n    try {\n      const resp = await axios.patch('api/users', formData, {\n        headers: {\n          Authorization: `Bearer ${token}`,\n          'Content-Type': 'multipart/form-data',\n        },\n      });\n\n      return resp.data.user;\n    } catch (error) {\n      return thunkAPI.rejectWithValue(error.message);\n    }\n  }\n);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}